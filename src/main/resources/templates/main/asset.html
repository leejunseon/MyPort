<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="includes/header"></th:block>

<!-- Begin Page Content -->
<div class="container-fluid">

	<div class="container-fluid">

		<!-- Page Heading -->
		<h1 class="h3 mb-4 text-gray-800">설정 비율</h1>
		<div class="card shadow mb-4">
			<div
				class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h6 class="m-0 font-weight-bold text-primary">자산</h6>
				<div class="dropdown no-arrow">
					<a class="dropdown-toggle" role="button" id="dropdownMenuLink"
						data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
						<i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
					</a>
					<div
						class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
						aria-labelledby="dropdownMenuLink">
						<div class="dropdown-header">EDIT</div>
						<a id="asdf" class="dropdown-item" data-toggle="modal"
							data-target="#addModal" data-id="asset">자산 추가</a> <a
							class="dropdown-item" data-toggle="modal"
							data-target="#editModal" data-id="asset">비율 수정</a>
					</div>
				</div>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6 mb-4">
						<div class="card border-left-primary shadow h-100 py-2">
							<div class="card-body">
								<div class="row no-gutters align-items-center">
									<table id="assetTable" class="table table-bordered">
										<thead>
											<tr>
												<th>자산</th>
												<th>비율</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6 mb-4">
						<div class="card border-left-primary shadow h-100 py-2">
							<div class="card-body">
								<div class="chart-pie pt-4">
									<canvas id="assetPieChart"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div class="card shadow mb-4">
			<div
				class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
				<h6 class="m-0 font-weight-bold text-primary">국가</h6>
				<div class="dropdown no-arrow">
					<a class="dropdown-toggle" href="#" role="button"
						id="dropdownMenuLink" data-toggle="dropdown" aria-haspopup="true"
						aria-expanded="false"> <i
						class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
					</a>
					<div
						class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
						aria-labelledby="dropdownMenuLink">
						<div class="dropdown-header">EDIT</div>
						<a class="dropdown-item" href="#" data-toggle="modal"
							data-target="#addModal" data-id="country">국가 추가</a> <a
							class="dropdown-item" href="#" data-toggle="modal"
							data-target="#editModal" data-id="country">비율 수정</a>
					</div>
				</div>
			</div>
			<div class="card-body">
				<div class="row">
					<div class="col-md-6 mb-4">
						<div class="card border-left-primary shadow h-100 py-2">
							<div class="card-body">
								<div class="row no-gutters align-items-center">
									<table id="countryTable" class="table table-bordered">
										<thead>
											<tr>
												<th>국가</th>
												<th>비율</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<div class="col-md-6 mb-4">
						<div class="card border-left-primary shadow h-100 py-2">
							<div class="card-body">
								<div class="chart-pie pt-4">
									<canvas id="countryPieChart"></canvas>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

	</div>
</div>
<!-- /.container-fluid -->


<script src="https://unpkg.com/axios/dist/axios.min.js"></script>
<script type="text/javascript" src="/js/utils/chart-pie.js"></script>
<script type="text/javascript" src="/js/data/asset.js"></script>
<script type="text/javascript" src="/js/data/country.js"></script>
<script type="text/javascript" th:inline="javascript">
	document.addEventListener("DOMContentLoaded", function() {

		//모달로 type(asset/country) 넘기기
 		$('#addModal').on('show.bs.modal', function(event) {
			var type = $(event.relatedTarget).data('id');
			console.log(event);
			console.log(type);
		});

		assetService.getAssets(1, function(result) {
			console.log(result);
			setStatus("assetTable", "assetPieChart", result);
		}, function(error) {
			console.log(error);
			alert(error);
		});

		countryService.getCountries(1, function(result) {
			console.log(result);
			setStatus("countryTable", "countryPieChart", result);
		}, function(error) {
			console.log(error);
			alert(error);
		})

		const modalFooter = document.querySelector(".modal-footer");
		console.log(modalFooter);
	});

	function setStatus(tableElementId, chartElementId, result) {
		const TableBody = document.getElementById(tableElementId).children[1];
		let nameList = [];
		let ratioList = [];
		let colorList = [];
		let bodyText = "";
		for (var i = 0; i < result.length; i++) {

			if (tableElementId.startsWith("asset")) {
				name = result[i].aName;
				ratio = result[i].aRatio;
			} else if (tableElementId.startsWith("country")) {
				name = result[i].cName;
				ratio = result[i].cRatio;
			}

			bodyText += "<tr><td>";
			bodyText += name;
			bodyText += "</td><td>";
			bodyText += ratio;
			bodyText += "%</td></tr>";

			nameList.push(name);
			ratioList.push(ratio);
			colorList.push(getColor());
		}
		TableBody.innerHTML = bodyText;

		pieChartService.setPieChart(chartElementId, nameList, ratioList,
				colorList);
	}

	function getColor() {
		return "#" + Math.round(Math.random() * 0xffffff).toString(16);
	}
</script>
<th:block th:replace="includes/footer"></th:block>
</html>